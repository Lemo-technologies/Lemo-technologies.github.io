<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LEMO-TUTOR | ELITE VISION TERMINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00ff88; --bg: #05070a; --glass: rgba(15, 20, 25, 0.9); --border: rgba(255, 255, 255, 0.1); --text: #f0f2f5; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; overflow: hidden; }
        
        .app-shell { display: flex; flex-direction: column; height: 100dvh; width: 100%; max-width: 1000px; margin: 0 auto; background: rgba(0,0,0,0.4); border-left: 1px solid var(--border); border-right: 1px solid var(--border); }
        
        header { padding: 1.2rem 1.5rem; background: rgba(5,7,10,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .logo { font-size: 1rem; font-weight: 700; letter-spacing: 4px; color: var(--accent); text-transform: uppercase; }
        .glow-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 12px var(--accent); display: inline-block; margin-right: 10px; }

        #chat-container { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }
        .message { max-width: 80%; padding: 16px 20px; border-radius: 18px; line-height: 1.6; font-size: 0.95rem; animation: pop 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { from { opacity: 0; transform: scale(0.95); } }
        
        .user-msg { align-self: flex-end; background: linear-gradient(135deg, rgba(0,255,136,0.15) 0%, rgba(0,255,136,0.05) 100%); border: 1px solid rgba(0,255,136,0.4); border-bottom-right-radius: 4px; color: var(--accent); }
        .ai-msg { align-self: flex-start; background: var(--glass); border: 1px solid var(--border); border-bottom-left-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }

        .input-area-wrapper { padding: 20px; background: linear-gradient(to top, var(--bg) 80%, transparent); }
        .input-card { background: #12171d; border: 1px solid var(--border); border-radius: 20px; padding: 8px 15px; display: flex; align-items: center; gap: 12px; transition: 0.3s; }
        .input-card:focus-within { border-color: var(--accent); box-shadow: 0 0 15px rgba(0,255,136,0.1); }
        
        input[type="text"] { flex: 1; background: transparent; border: none; color: white; padding: 12px; font-size: 16px; outline: none; }
        .action-btn { background: transparent; border: none; color: var(--accent); cursor: pointer; font-size: 1.3rem; opacity: 0.7; transition: 0.2s; }
        .action-btn:hover { opacity: 1; transform: scale(1.1); }
        .send-btn { background: var(--accent); color: #000; border: none; width: 45px; height: 45px; border-radius: 15px; font-weight: 900; cursor: pointer; transition: 0.2s; }
        .send-btn:active { transform: scale(0.9); }

        #preview-box { display: none; padding: 10px; text-align: left; }
        #preview-box img { height: 70px; border-radius: 10px; border: 2px solid var(--accent); }

        pre { background: #000; padding: 15px; border-radius: 12px; overflow-x: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; border: 1px solid #222; margin: 10px 0; }
        
        #lock-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .lock-card { width: 85%; max-width: 350px; padding: 40px; background: #0a0a0a; border: 1px solid var(--accent); border-radius: 30px; text-align: center; }
    </style>
</head>
<body>

<div id="lock-screen">
    <div class="lock-card">
        <h2 style="color:var(--accent); letter-spacing: 5px; font-size: 1.2rem;">CORE LOCKED</h2>
        <p style="font-size: 0.7rem; opacity: 0.5; margin-bottom: 30px;">ENTER ENCRYPTION KEY TO START</p>
        <input type="password" id="passKey" placeholder="gsk_..." style="width:100%; padding:15px; background:#111; border:1px solid #333; color:white; border-radius:12px; margin-bottom:20px; box-sizing:border-box;">
        <button onclick="unlock()" style="width:100%; padding:15px; background:var(--accent); border:none; font-weight:800; border-radius:12px; cursor:pointer;">INITIALIZE SYSTEM</button>
    </div>
</div>

<div class="app-shell">
    <header>
        <div class="logo"><span class="glow-dot"></span>LEMO-TUTOR 3.0</div>
        <div style="font-size: 0.6rem; color: #444;">V-ENGINE ACTIVE</div>
    </header>

    <div id="chat-container">
        <div class="message ai-msg">Elite Terminal Active. Engineering systems, mathematical logic, and visual analysis ready. How can I assist your empire today?</div>
    </div>

    <div class="input-area-wrapper">
        <div id="preview-box"></div>
        <div class="input-card">
            <button class="action-btn" onclick="document.getElementById('imgInp').click()">ðŸ“Ž</button>
            <input type="file" id="imgInp" accept="image/*" style="display:none" onchange="handleImg()">
            <input type="text" id="userInp" placeholder="Type or upload problem..." onkeypress="if(event.key==='Enter') execute()">
            <button class="send-btn" onclick="execute()">â†’</button>
        </div>
    </div>
</div>

<script>
    let ACTIVE_KEY = localStorage.getItem('L_KEY');
    let imgData = null;
    if(ACTIVE_KEY) document.getElementById('lock-screen').style.display = 'none';

    function unlock() {
        const k = document.getElementById('passKey').value.trim();
        if(k.startsWith('gsk_')) { localStorage.setItem('L_KEY', k); location.reload(); }
        else alert("INVALID KEY");
    }

    function handleImg() {
        const file = document.getElementById('imgInp').files[0];
        const reader = new FileReader();
        reader.onloadend = () => {
            imgData = reader.result;
            document.getElementById('preview-box').innerHTML = `<img src="${imgData}">`;
            document.getElementById('preview-box').style.display = 'block';
        };
        if(file) reader.readAsDataURL(file);
    }

    async function execute() {
        const box = document.getElementById('userInp');
        const query = box.value.trim();
        if(!query && !imgData) return;

        addMsg(query || "Analyzing visual input...", 'user-msg');
        box.value = '';
        document.getElementById('preview-box').style.display = 'none';
        const load = addMsg('<span style="letter-spacing:2px; font-size:0.7rem; opacity:0.5;">SOLVING...</span>', 'ai-msg');

        try {
            // Fix: Use llama-3.2-11b-vision-preview for images
            const model = imgData ? "llama-3.2-11b-vision-preview" : "llama-3.3-70b-versatile";
            
            const content = [];
            if(query) content.push({ type: "text", text: query });
            if(imgData) content.push({ type: "image_url", image_url: { url: imgData } });

            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${localStorage.getItem('L_KEY')}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: model,
                    messages: [{ role: "user", content: content }],
                    temperature: 0.5
                })
            });

            const data = await response.json();
            document.getElementById(load).remove();
            imgData = null;

            if(data.choices) addMsg(parse(data.choices[0].message.content), 'ai-msg');
            else addMsg("SYSTEM FAULT: Check Key or Limit.", 'ai-msg');
        } catch(e) {
            document.getElementById(load).remove();
            addMsg("CONNECTION LOST.", 'ai-msg');
        }
    }

    function addMsg(h, c) {
        const d = document.createElement('div'); d.className = `message ${c}`; d.innerHTML = h; d.id = 'm-' + Date.now();
        const ctr = document.getElementById('chat-container'); ctr.appendChild(d);
        ctr.scrollTop = ctr.scrollHeight; return d.id;
    }

    function parse(t) {
        return t.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
    }
</script>
</body>
</html>
