<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LEMO-TUTOR | L-4 SCOUT TERMINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #00ff88; --bg: #05070a; --glass: rgba(15, 20, 25, 0.95); --border: rgba(255, 255, 255, 0.1); --text: #f0f2f5; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; overflow: hidden; }
        .app-shell { display: flex; flex-direction: column; height: 100dvh; width: 100%; max-width: 1000px; margin: 0 auto; border-left: 1px solid var(--border); border-right: 1px solid var(--border); }
        header { padding: 1.2rem 1.5rem; background: rgba(5,7,10,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 100; }
        .logo { font-size: 1rem; font-weight: 700; letter-spacing: 4px; color: var(--accent); text-transform: uppercase; }
        .glow-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 12px var(--accent); display: inline-block; margin-right: 10px; }
        #chat-container { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 20px; scroll-behavior: smooth; }
        .message { max-width: 85%; padding: 16px 20px; border-radius: 18px; line-height: 1.6; font-size: 0.95rem; animation: pop 0.25s ease; }
        .user-msg { align-self: flex-end; background: linear-gradient(135deg, rgba(0,255,136,0.1) 0%, rgba(0,255,136,0.02) 100%); border: 1px solid rgba(0, 255, 136, 0.4); border-bottom-right-radius: 4px; color: var(--accent); }
        .ai-msg { align-self: flex-start; background: var(--glass); border: 1px solid var(--border); border-bottom-left-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .input-area-wrapper { padding: 20px; background: linear-gradient(to top, var(--bg) 80%, transparent); }
        .input-card { background: #12171d; border: 1px solid var(--border); border-radius: 20px; padding: 8px 15px; display: flex; align-items: center; gap: 12px; }
        input[type="text"] { flex: 1; background: transparent; border: none; color: white; padding: 12px; font-size: 16px; outline: none; }
        .send-btn { background: var(--accent); color: #000; border: none; width: 45px; height: 45px; border-radius: 15px; font-weight: 900; cursor: pointer; }
        #preview-box { display: none; padding: 10px; text-align: left; }
        #preview-box img { height: 60px; border-radius: 8px; border: 1px solid var(--accent); }
        #lock-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .lock-card { width: 85%; max-width: 350px; padding: 40px; background: #0a0a0a; border: 1px solid var(--accent); border-radius: 30px; text-align: center; }
        pre { background: #000; padding: 12px; border-radius: 8px; overflow-x: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; border: 1px solid #222; margin: 10px 0; }
    </style>
</head>
<body>

<div id="lock-screen">
    <div class="lock-card">
        <h2 style="color:var(--accent); letter-spacing: 5px;">CORE LOCKED</h2>
        <input type="password" id="passKey" placeholder="Enter gsk_ key..." style="width:100%; padding:15px; background:#111; border:1px solid #333; color:white; border-radius:12px; margin: 20px 0; box-sizing:border-box;">
        <button onclick="unlock()" style="width:100%; padding:15px; background:var(--accent); border:none; font-weight:800; border-radius:12px; cursor:pointer;">INITIALIZE</button>
    </div>
</div>

<div class="app-shell">
    <header><div class="logo"><span class="glow-dot"></span>LEMO-TUTOR 3.3</div></header>
    <div id="chat-container">
        <div class="message ai-msg">Llama 4 Scout Engine Online. Multimodal analysis active. Post an image or query.</div>
    </div>
    <div class="input-area-wrapper">
        <div id="preview-box"></div>
        <div class="input-card">
            <button style="background:transparent; border:none; color:var(--accent); font-size:1.5rem; cursor:pointer;" onclick="document.getElementById('imgInp').click()">ðŸ“Ž</button>
            <input type="file" id="imgInp" accept="image/*" style="display:none" onchange="handleImg()">
            <input type="text" id="userInp" placeholder="Ask Lemo-Tutor..." onkeypress="if(event.key==='Enter') execute()">
            <button class="send-btn" onclick="execute()">â†’</button>
        </div>
    </div>
</div>

<script>
    let ACTIVE_KEY = localStorage.getItem('L_KEY');
    let imgBase64 = null;
    if(ACTIVE_KEY) document.getElementById('lock-screen').style.display = 'none';

    function unlock() {
        const k = document.getElementById('passKey').value.trim();
        if(k.startsWith('gsk_')) { localStorage.setItem('L_KEY', k); location.reload(); }
        else alert("INVALID KEY");
    }

    function handleImg() {
        const file = document.getElementById('imgInp').files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const MAX_WIDTH = 700; 
                let width = img.width; let height = img.height;
                if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                canvas.width = width; canvas.height = height;
                canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                imgBase64 = canvas.toDataURL('image/jpeg', 0.6);
                document.getElementById('preview-box').innerHTML = `<img src="${imgBase64}">`;
                document.getElementById('preview-box').style.display = 'block';
            };
            img.src = e.target.result;
        };
        if(file) reader.readAsDataURL(file);
    }

    async function execute() {
        const queryBox = document.getElementById('userInp');
        const query = queryBox.value.trim();
        if(!query && !imgBase64) return;

        addMsg(query || "Analyzing visual diagram...", 'user-msg');
        queryBox.value = '';
        document.getElementById('preview-box').style.display = 'none';
        const load = addMsg('<span style="opacity:0.5; letter-spacing:2px;">SCOUTING...</span>', 'ai-msg');

        try {
            // THE 2026 ENGINE: Llama 4 Scout handles both text and vision natively
            const model = "meta-llama/llama-4-scout-17b-16e-instruct";
            
            let messages = [];
            if (imgBase64) {
                messages.push({
                    role: "user",
                    content: [
                        { type: "text", text: query || "Analyze this engineering diagram/problem." },
                        { type: "image_url", image_url: { url: imgBase64 } }
                    ]
                });
            } else {
                messages.push({ role: "user", content: query });
            }

            const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${localStorage.getItem('L_KEY')}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ model: model, messages: messages, temperature: 0.2 })
            });

            const data = await response.json();
            document.getElementById(load).remove();
            imgBase64 = null;

            if(data.choices) {
                addMsg(parse(data.choices[0].message.content), 'ai-msg');
            } else {
                addMsg("SYSTEM FAULT: " + (data.error?.message || "Check Model ID"), 'ai-msg');
            }
        } catch(e) {
            document.getElementById(load).remove();
            addMsg("OFFLINE.", 'ai-msg');
        }
    }

    function addMsg(h, c) {
        const d = document.createElement('div'); d.className = `message ${c}`; d.innerHTML = h; d.id = 'm-' + Date.now();
        const ctr = document.getElementById('chat-container'); ctr.appendChild(d);
        ctr.scrollTop = ctr.scrollHeight; return d.id;
    }

    function parse(t) {
        return t.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>').replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
    }
</script>
</body>
</html>
